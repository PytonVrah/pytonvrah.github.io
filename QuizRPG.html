<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University RPG - Dungeon Crawler</title>
    
    <!-- Retro Pixel Font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

    <style>
        :root {
            --text-color: #ecf0f1;
            --card-bg: #2c3e50;
            --card-border: #ecf0f1;
            --remove-btn: #27ae60;
            --keep-btn: #c0392b;
            --gold-color: #f1c40f;
            --hot-color: #ff4500;
            --hp-color: #e74c3c;
            --overlay-color: rgba(0, 0, 0, 0.7);
        }

        body.dark-mode {
            --card-bg: #1a1a1a;
        }

        body {
            font-family: 'VT323', monospace; /* Retro console font for text */
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            user-select: none;
            
            /* --- VECTOR / LOW POLY BACKGROUNDS --- */
            
            /* HUB - Tavern (Warm Abstract/Low Poly) */
            background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1964&auto=format&fit=crop');
            
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            position: relative;
            transition: background-image 0.5s ease-in-out;
            image-rendering: pixelated; /* Sharpens images on some browsers */
        }

        /* MANA≈ΩMENT - Cave (Dark Geometric) */
        body.bg-cave {
            background-image: url('https://images.unsplash.com/photo-1614850523459-c2f4c699c52e?q=80&w=2070&auto=format&fit=crop');
        }

        /* TE√ìRIA M√âDI√ç - Mountains (Minimalist/Vector) */
        body.bg-mountains {
            background-image: url('https://images.unsplash.com/photo-1506259091721-347f793bb76d?q=80&w=2070&auto=format&fit=crop');
        }

        /* Scanline Overlay Effect for Retro Feel */
        body::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            z-index: -1;
            pointer-events: none;
        }

        /* Dark Overlay */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); 
            z-index: -2;
        }

        body.rage-mode::before {
            background: rgba(80, 0, 0, 0.7);
        }
        body.rage-mode {
            animation: shakeScreen 0.5s infinite;
        }
        @keyframes shakeScreen {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, .hot-header, .boss-info, .stat-box, .subject-btn {
            font-family: 'Press Start 2P', cursive; /* Pixel font */
            text-transform: uppercase;
        }

        h1.game-title {
            font-size: 1.5rem; /* Smaller font size for pixel fonts */
            color: #fff;
            text-shadow: 4px 4px 0px #000;
            margin-top: 80px;
            display: none;
            line-height: 1.5;
        }

        /* --- UPRAVEN√Å TYPOGRAFIA PRE KARTY --- */
        h2 { 
            font-size: 1.2rem; 
            color: #f1c40f; /* Zlat√° farba pre nadpis kateg√≥rie */
            text-transform: uppercase; 
            margin-bottom: 30px; /* Viac miesta pod nadpisom */
            text-shadow: 2px 2px 0 #000;
            letter-spacing: 2px;
        }

        p.content-text {
            font-family: 'VT323', monospace;
            font-size: 2.4rem; /* V√Ωrazne v√§ƒç≈°ie p√≠smo */
            line-height: 1.4; /* Lep≈°ie riadkovanie */
            font-weight: 500;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8);
            max-width: 90%; /* Text nebude nar√°≈æa≈• do okrajov */
            margin: 0 auto; /* Centrovanie bloku */
        }

        /* --- HUB STYLES --- */
        .hub-container {
            text-align: center;
            z-index: 100;
            padding: 30px;
            background: #2c3e50;
            border: 4px solid #fff;
            box-shadow: 10px 10px 0px #000; /* Hard shadow */
            max-width: 600px;
            width: 90%;
        }

        .hub-title {
            font-size: 2rem;
            color: var(--gold-color);
            text-shadow: 4px 4px 0 #000;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .subject-btn {
            background: #34495e;
            border: 4px solid #fff;
            color: white;
            padding: 20px;
            font-size: 0.8rem;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.1s;
            text-align: center;
            display: block;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 5px 5px 0px #000;
        }

        .subject-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0px #000;
            background: #2c3e50;
            color: var(--gold-color);
        }

        .subject-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0px #000;
        }

        /* --- UI ELEMENTS --- */
        .header-ui {
            position: absolute;
            top: 20px;
            width: 90%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 90;
            pointer-events: none;
        }

        .stats-left, .stats-right {
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-box {
            background: #000;
            padding: 10px;
            border: 2px solid #fff;
            color: #fff;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.5);
        }

        .gold-display { color: var(--gold-color); border-color: var(--gold-color); }
        .hp-display { color: var(--hp-color); border-color: var(--hp-color); }
        
        .shop-btn {
            background: #2c3e50;
            border: 2px solid gold;
            color: gold;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.5rem;
            padding: 10px;
            cursor: pointer;
            box-shadow: 3px 3px 0 #000;
        }
        .shop-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }
        .shop-btn:disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }

        .menu-btn {
            background: #c0392b;
            border: 2px solid #fff;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.5rem;
            padding: 8px;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 3px 3px 0 #000;
        }

        /* --- CARDS --- */
        .game-wrapper {
            width: 90%; max-width: 600px; position: relative; min-height: 400px;
            display: none; justify-content: center; align-items: center;
        }

        .container { width: 100%; perspective: 1000px; z-index: 10; }

        .card {
            background: transparent;
            min-height: 400px; /* Trochu vy≈°≈°ia karta */
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy flip */
        }

        .card.flipped { transform: rotateY(180deg); }

        .card-content, .card-back {
            width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: absolute; top: 0; left: 0; 
            padding: 40px; /* Viac priestoru okolo textu */
            box-sizing: border-box;
            background-color: var(--card-bg);
            border: 4px solid #fff;
            box-shadow: 8px 8px 0px #000;
        }

        .card-back { transform: rotateY(180deg); border-color: var(--gold-color); }

        /* --- HOT CARD --- */
        .hot-container {
            display: none; width: 100%;
            background: #500;
            border: 4px solid var(--hot-color);
            box-shadow: 8px 8px 0px #000;
            padding: 30px; /* Viac priestoru */
            flex-direction: column; align-items: center;
            animation: pulseBorder 1s infinite;
        }

        @keyframes pulseBorder {
            0% { border-color: #ff4500; }
            50% { border-color: #ffff00; }
            100% { border-color: #ff4500; }
        }

        .hot-header { color: #fff; font-size: 1rem; margin-bottom: 20px; text-shadow: 2px 2px 0 #000; }
        
        .timer-bar-bg {
            width: 100%; height: 15px; background: #000; border: 2px solid #fff; margin-bottom: 20px;
        }
        .timer-bar-fill { height: 100%; width: 100%; background: #ff4500; transition: width 1s linear; }

        .hot-question-text {
            font-family: 'VT323', monospace;
            font-size: 2rem; 
            font-weight: bold; 
            margin-bottom: 30px;
            text-align: center; 
            text-shadow: 2px 2px 0px #000;
            line-height: 1.3;
        }

        .abcd-grid { display: grid; grid-template-columns: 1fr; gap: 15px; width: 100%; }
        
        .abcd-btn {
            background: #2c3e50; border: 2px solid #fff; color: #fff;
            padding: 20px; font-family: 'VT323', monospace; font-size: 1.5rem;
            cursor: pointer; text-align: left; box-shadow: 4px 4px 0 #000;
        }
        .abcd-btn:hover { background: #34495e; transform: translate(-1px, -1px); box-shadow: 5px 5px 0 #000; }
        .abcd-btn.correct-select { background: #27ae60; border-color: #2ecc71; }
        .abcd-btn.wrong-select { background: #c0392b; border-color: #e74c3c; }
        .abcd-btn.hidden-hint { opacity: 0.2; pointer-events: none; }

        /* --- BOSS BAR --- */
        .boss-section {
            width: 90%; max-width: 600px; margin-top: 30px; display: none;
        }
        .boss-info {
            display: flex; justify-content: space-between; margin-bottom: 5px;
            font-size: 0.7rem; color: #fff; text-shadow: 2px 2px 0 #000;
        }
        .boss-bar-frame {
            width: 100%; height: 30px; background: #000; border: 4px solid #fff;
            position: relative; box-shadow: 5px 5px 0 #000;
        }
        .boss-bar-fill {
            height: 100%; width: 100%; transition: width 0.2s;
            background: #9b59b6;
        }
        .boss-bar-fill.phase-2 { background: #f39c12; }
        .boss-bar-fill.phase-3 { background: #e74c3c; }

        /* --- CONTROLS --- */
        .controls {
            display: none; gap: 20px; margin-top: 30px; visibility: hidden; height: 50px; justify-content: center;
        }
        .controls.visible { visibility: visible; }

        .btn {
            padding: 15px 30px; border: 3px solid #fff; font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem; cursor: pointer; color: white; text-transform: uppercase;
            box-shadow: 5px 5px 0px #000;
        }
        .btn:active { transform: translate(3px, 3px); box-shadow: 2px 2px 0px #000; }
        .btn-remove { background-color: var(--remove-btn); }
        .btn-keep { background-color: var(--keep-btn); }

        /* --- ADVERTISEMENT --- */
        .ad-container {
            margin-top: 40px;
            background: #000;
            padding: 10px;
            border: 2px solid #3498db;
            text-align: center;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            box-shadow: 5px 5px 0 #3498db;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            z-index: 50;
        }
        .ad-container:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 #fff; border-color: #fff; }
        .ad-badge { background: #e74c3c; color: white; padding: 2px 5px; font-family: 'Press Start 2P', cursive; font-size: 0.5rem; }

        /* --- EFFECTS & FLOATING TEXT --- */
        .floating-text {
            position: absolute; font-family: 'Press Start 2P', cursive; font-size: 1rem;
            pointer-events: none; animation: floatUp 1s forwards; z-index: 200; 
            text-shadow: 2px 2px 0px black;
        }
        .text-gain { color: #2ecc71; }
        .text-loss { color: #e74c3c; }
        .text-hot-gain { color: #ffae00; font-size: 1.5rem; }

        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); } }

        .end-screen { 
            display: none; text-align: center; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #2c3e50; padding: 40px; border: 4px solid #fff;
            box-shadow: 10px 10px 0px #000; z-index: 200; width: 80%; max-width: 500px;
        }
        .end-screen h2 { font-size: 2rem; color: var(--gold-color); text-shadow: 4px 4px 0 #000; margin-bottom: 20px; }
        .rank { font-size: 2rem; font-weight: bold; margin: 20px 0; text-shadow: 3px 3px 0px #000; font-family: 'VT323', monospace; }

        /* Visual Effects Layers */
        .effect-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 50; opacity: 0; }
        .magic-fire { background: radial-gradient(circle, rgba(255,69,0,0.6) 0%, transparent 70%); animation: flash 0.5s; }
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }

    </style>
</head>
<body>

    <!-- MAIN HUB (MENU) -->
    <div class="hub-container" id="hub-container">
        <h1 class="hub-title">RPG UNIVERSITY</h1>
        <p class="hub-subtitle" style="font-family: 'VT323', monospace; font-size: 1.5rem;">Vyber si dungeon:</p>
        <div class="subject-grid">
            <button class="subject-btn" onclick="startGame('MaM')">ü™® Jasky≈àa Mana≈æmentu</button>
            <button class="subject-btn" onclick="startGame('TM')">üèîÔ∏è Hory Te√≥rie M√©di√≠</button>
        </div>
    </div>

    <!-- HUD -->
    <div class="header-ui" id="header-ui" style="display: none;">
        <div class="stats-left">
            <div class="stat-box hp-display">
                <span>‚ù§Ô∏è</span>
                <span id="player-hp">5/5</span>
            </div>
            <div class="stat-box gold-display">
                <span>üí∞</span>
                <span id="gold-count">0</span>
            </div>
            <button class="shop-btn" id="btn-buy-potion" onclick="buyPotion()" title="Dopln√≠ 1 ≈æivot (Cena: 50g)">
                üß™ +1 HP (50g)
            </button>
        </div>
        
        <div class="stats-right">
            <div class="stat-box combo-display" id="combo-box">
                <span>üî•</span>
                <span id="combo-count">0x</span>
            </div>
            <button class="menu-btn" onclick="backToMenu()">üè† EXIT</button>
            <button class="shop-btn" id="btn-buy-hint" onclick="buyHint()" title="V Hot Mode odstr√°ni 2 zl√© odpovede (Cena: 30g)" disabled>
                üí° ≈§ah√°k (30g)
            </button>
        </div>
    </div>

    <h1 class="game-title" id="game-title">PREDMET</h1>
    <p id="game-subtitle" style="display: none; opacity: 0.9; margin-bottom: 20px; text-shadow: 2px 2px 0px #000; color: #ccc; text-align: center; font-family: 'VT323', monospace; font-size: 1.3rem;">
        Boss ƒç√≠ha v tme... (10% ≈°anca na HOT Encounter)
    </p>

    <!-- GAME WRAPPER -->
    <div id="game-section" class="game-wrapper">
        <div id="effect-layer" class="effect-overlay"></div>

        <!-- STANDARD CARD -->
        <div class="container" id="card-container" onclick="flipCard()">
            <div class="card" id="flashcard">
                <div class="card-content" id="card-front">
                    <h2 id="category-front">Kateg√≥ria</h2>
                    <p class="content-text" id="question-text">Naƒç√≠tavam...</p>
                </div>
                <div class="card-back" id="card-back">
                    <h2 id="category-back">Odpoveƒè</h2>
                    <p class="content-text" id="answer-text">...</p>
                </div>
            </div>
        </div>

        <!-- HOT QUESTION CARD -->
        <div class="hot-container" id="hot-container">
            <div class="hot-header">üî• HOT ENCOUNTER üî•</div>
            <div class="timer-bar-bg">
                <div class="timer-bar-fill" id="timer-fill"></div>
            </div>
            <p class="hot-question-text" id="hot-question-text">Ot√°zka...</p>
            <div class="abcd-grid" id="abcd-options">
                <!-- Buttons via JS -->
            </div>
        </div>
    </div>

    <!-- CONTROLS -->
    <div class="controls" id="action-controls">
        <button class="btn btn-keep" onclick="keepCard(event)">‚ùå NEVIEM</button>
        <button class="btn btn-remove" onclick="removeCard(event)">‚úÖ VIEM</button>
    </div>

    <!-- BOSS BAR -->
    <div class="boss-section" id="boss-ui">
        <div class="boss-info">
            <span id="boss-name">FINAL BOSS</span>
            <span id="hp-text">100%</span>
        </div>
        <div class="boss-bar-frame">
            <div class="boss-bar-fill" id="boss-health"></div>
        </div>
    </div>

    <!-- ADVERTISEMENT -->
    <a href="https://mmmyster.itch.io/sen-z-ust" target="_blank" class="ad-container">
        <span class="ad-badge">NEW QUEST</span>
        <span class="ad-text">Zahraj si moju hru: Sen z √∫st (Itch.io)</span>
    </a>

    <!-- END SCREEN -->
    <div id="end-screen" class="end-screen">
        <h2 id="end-title">VICTORY!</h2>
        <p id="end-msg" style="font-family: 'VT323', monospace; font-size: 1.5rem;">Boss bol porazen√Ω.</p>
        <p style="font-family: 'VT323', monospace;">Loot:</p>
        <div class="rank" id="final-gold">0 G</div>
        <p style="font-family: 'VT323', monospace;">Rank:</p>
        <div class="rank" id="final-rank">Novice</div>
        <button class="btn btn-remove" onclick="backToMenu()">N√°vrat do Hubu</button>
    </div>

    <script>
        // ================= DATABASES =================

        // 1. MANA≈ΩMENT A MARKETING (MaM)
        const questionsMaM = [
            { q: "Definujte mana≈æment ako vedn√∫ discipl√≠nu.", a: "S√∫bor poznatkov o princ√≠poch, met√≥dach a postupoch riadenia organiz√°ci√≠ (emp√≠ria + veda)." },
            { q: "Vymenujte funkcie mana≈æmentu (Fayol).", a: "Predv√≠danie, Organizovanie, Prikazovanie, Koordinovanie, Kontrola." },
            { q: "Skratka POSDCORB (Gulick)?", a: "Planning, Organizing, Staffing, Directing, Coordinating, Reporting, Budgeting." },
            { q: "Definujte rozhodovanie.", a: "ƒåinnos≈• urƒçovania a analyzovania probl√©mu a v√Ωberu najv√Ωhodnej≈°ieho rie≈°enia." },
            { q: "Rozhodovanie v riziku?", a: "Pozn√°me pravdepodobnos≈• v√Ωsledkov, ale nie v√Ωsledok samotn√Ω." },
            { q: "Brainstorming je?", a: "Skupinov√° met√≥da generovania n√°padov bez okam≈æitej kritiky." },
            { q: "SMART ciele s√∫?", a: "Specific, Measurable, Achievable, Realistic, Time-bound." },
            { q: "Strategick√© pl√°novanie?", a: "Dlhodob√© (5+ rokov), t√Ωka sa celku." },
            { q: "L√≠niov√° ≈°trukt√∫ra?", a: "Princ√≠p jedin√©ho ved√∫ceho, jednoduch√© vz≈•ahy." },
            { q: "Maticov√° ≈°trukt√∫ra?", a: "Dvojit√° podriadenos≈• (funkƒçn√Ω + projektov√Ω ved√∫ci)." },
            { q: "Te√≥ria X (McGregor)?", a: "ƒΩudia s√∫ leniv√≠, potrebuj√∫ kontrolu." },
            { q: "Te√≥ria Y (McGregor)?", a: "ƒΩudia s√∫ akt√≠vni, potrebuj√∫ motiv√°ciu." },
            { q: "Marketingov√Ω mix (4P)?", a: "Product, Price, Place, Promotion." },
            { q: "SWOT anal√Ωza?", a: "Strengths, Weaknesses, Opportunities, Threats." },
            { q: "Segment√°cia?", a: "Rozdelenie trhu na homog√©nne skupiny z√°kazn√≠kov." },
            { q: "PPC reklama?", a: "Platba za kliknutie (Pay Per Click)." },
            { q: "SEO?", a: "Optimaliz√°cia pre vyhƒæad√°vaƒçe." },
            { q: "Vysvetlite 'Subjektivizmus' v rozhodovan√≠.", a: "Riziko ovplyvnenia rozhodnutia osobn√Ωmi n√°zormi a n√°ladou." },
            { q: "ƒåo je to 'Ploch√°' O≈†R?", a: "M√°lo stup≈àov riadenia, ≈°irok√© rozp√§tie." },
            { q: "ƒåo s√∫ to 'M√§kk√© zruƒçnosti'?", a: "Komunik√°cia, t√≠mov√° pr√°ca, empatia." }
        ];

        // 2. TE√ìRIA M√âDI√ç (TM)
        const questionsTM = [
            { q: "Definujte Medi√°lne ≈°t√∫di√° (M. Boƒç√°k).", a: "Vedn√° discipl√≠na zaoberaj√∫ca sa m√©diami v ich celistvosti, v komplexnom soci√°lno-kult√∫rnom kontexte." },
            { q: "Ak√Ω je rozdiel medzi TMK a Medi√°lnymi ≈°t√∫diami?", a: "TMK: pas√≠vny pr√≠jemca, propaganda. M≈†: akt√≠vne publikum, interpret√°cia." },
            { q: "Vymenujte 4 modely komunik√°cie (McQuail).", a: "Prenosov√Ω, Ritu√°lov√Ω, Propagaƒçn√Ω, Pr√≠jmov√Ω." },
            { q: "Lasswellov model komunik√°cie?", a: "Kto? Hovor√≠ ƒço? Ak√Ωm kan√°lom? Komu? S ak√Ωm √∫ƒçinkom?" },
            { q: "Vysvetlite Ritu√°lov√Ω model komunik√°cie.", a: "Komunik√°cia ako zdieƒæanie, √∫ƒças≈• a udr≈æiavanie spoloƒçnosti (nie len prenos info)." },
            { q: "ƒåo je to Semiotika?", a: "Veda o znakoch a tvorbe v√Ωznamov." },
            { q: "3 typy znakov podƒæa Peirca?", a: "Ikona (podoba), Index (s√∫vislos≈•), Symbol (dohoda)." },
            { q: "Rozdiel: Hor√∫ce vs. Studen√© m√©di√° (McLuhan)?", a: "Hor√∫ce: veƒæa d√°t, n√≠zka particip√°cia. Studen√©: m√°lo d√°t, vysok√° particip√°cia." },
            { q: "Definujte 'Masu'.", a: "Anonymn√Ω, rozpt√Ωlen√Ω s√∫bor ƒæud√≠ bez v√§zieb." },
            { q: "ƒåo je to 'Gatekeeping'?", a: "Proces v√Ωberu inform√°ci√≠ do spr√°v (vr√°tnik)." },
            { q: "ƒåo je to 'Infotainment'?", a: "Spr√°vy pod√°van√© z√°bavnou formou (Info + Entertainment)." },
            { q: "Vysvetlite pojem 'Disneyfik√°cia'.", a: "Zjednodu≈°enie reality na z√°bavn√∫ a bezpeƒçn√∫ verziu." },
            { q: "ƒåo je to '≈Ω√°ner'?", a: "Ust√°len√Ω typ medi√°lneho produktu so spoloƒçn√Ωmi znakmi." },
            { q: "Vysvetlite pojem 'Stereotyp'.", a: "Zjednodu≈°en√Ω obraz skupiny ƒæud√≠, zveliƒçuj√∫ci vlastnosti." },
            { q: "ƒåo je to 'Agenda Setting'?", a: "M√©di√° urƒçuj√∫, o ƒçom m√°me prem√Ω≈°ƒæa≈• (nastoƒæovanie t√©m)." },
            { q: "Denot√°cia vs. Konot√°cia?", a: "Denot√°cia = doslovn√Ω v√Ωznam. Konot√°cia = pridan√Ω, emoƒçn√Ω v√Ωznam." }
        ];

        // ================= GAME LOGIC =================

        let currentDeck = [];
        let activeDeckName = "";
        let deck = [];
        
        let gold = 0;
        let playerHP = 5;
        let combo = 0;
        let isFlipped = false;
        let isHotMode = false;
        let rageModeActive = false;
        let hotTimerInterval;

        // Elements
        const hubContainer = document.getElementById('hub-container');
        const gameSection = document.getElementById('game-section');
        const controls = document.getElementById('action-controls');
        const bossUi = document.getElementById('boss-ui');
        const headerUi = document.getElementById('header-ui');
        const gameTitle = document.getElementById('game-title');
        const gameSubtitle = document.getElementById('game-subtitle');
        const cardContainer = document.getElementById('card-container');
        const flashcard = document.getElementById('flashcard');
        const questionText = document.getElementById('question-text');
        const answerText = document.getElementById('answer-text');
        const categoryFront = document.getElementById('category-front');
        const bossBar = document.getElementById('boss-health');
        const hpText = document.getElementById('hp-text');
        const bossName = document.getElementById('boss-name');
        const goldDisplay = document.getElementById('gold-count');
        const playerHpDisplay = document.getElementById('player-hp');
        const comboDisplay = document.getElementById('combo-count');
        const comboBox = document.getElementById('combo-box');
        const btnBuyPotion = document.getElementById('btn-buy-potion');
        const btnBuyHint = document.getElementById('btn-buy-hint');
        const hotContainer = document.getElementById('hot-container');
        const hotQuestionText = document.getElementById('hot-question-text');
        const abcdOptions = document.getElementById('abcd-options');
        const timerFill = document.getElementById('timer-fill');
        const effectLayer = document.getElementById('effect-layer');

        // --- MENU LOGIC ---

        function startGame(subject) {
            document.body.className = ''; 

            if (subject === 'MaM') {
                document.body.classList.add('bg-cave');
                currentDeck = [...questionsMaM, ...questionsMaM];
                activeDeckName = "MANA≈ΩMENT A MARKETING";
                bossName.innerText = "CAVE BOSS";
            } else if (subject === 'TM') {
                document.body.classList.add('bg-mountains');
                currentDeck = [...questionsTM, ...questionsTM]; 
                activeDeckName = "TE√ìRIA M√âDI√ç";
                bossName.innerText = "MOUNTAIN TITAN";
            }

            deck = [...currentDeck];
            gold = 0;
            playerHP = 5;
            combo = 0;
            rageModeActive = false;
            document.body.classList.remove('rage-mode');
            
            hubContainer.style.display = 'none';
            headerUi.style.display = 'flex';
            gameTitle.style.display = 'block';
            gameTitle.innerText = activeDeckName;
            gameSubtitle.style.display = 'block';
            gameSection.style.display = 'flex';
            bossUi.style.display = 'block';
            document.getElementById('end-screen').style.display = 'none';

            updateUI();
            loadCard();
        }

        function backToMenu() {
            headerUi.style.display = 'none';
            gameTitle.style.display = 'none';
            gameSubtitle.style.display = 'none';
            gameSection.style.display = 'none';
            controls.style.display = 'none';
            bossUi.style.display = 'none';
            document.getElementById('end-screen').style.display = 'none';
            
            hubContainer.style.display = 'block';
            document.body.className = ''; 
            document.body.classList.remove('rage-mode');
        }

        // --- GAME FUNCTIONS ---

        function updateUI() {
            goldDisplay.innerText = gold;
            playerHpDisplay.innerText = "‚ù§Ô∏è".repeat(playerHP);
            if (playerHP <= 2) playerHpDisplay.style.color = "red";
            else playerHpDisplay.style.color = "#e74c3c";

            if(combo > 1) {
                comboBox.classList.add('active');
                comboDisplay.innerText = combo + "x";
            } else {
                comboBox.classList.remove('active');
            }

            const totalCards = currentDeck.length; 
            const currentCards = deck.length;
            const percentage = (currentCards / totalCards) * 100;
            
            bossBar.style.width = `${percentage}%`;
            hpText.innerText = `${Math.round(percentage)}%`;
            
            if (percentage < 30 && !rageModeActive && deck.length > 0) {
                activateRageMode();
            }

            bossBar.className = 'boss-bar-fill';
            if (percentage < 30) bossBar.classList.add('phase-3');
            else if (percentage < 60) bossBar.classList.add('phase-2');

            btnBuyPotion.disabled = (gold < 50 || playerHP >= 5);
            btnBuyHint.disabled = (gold < 30 || !isHotMode);
        }

        function activateRageMode() {
            rageModeActive = true;
            document.body.classList.add('rage-mode');
            showFloatingText("RAGE MODE!", "text-loss");
        }

        function showFloatingText(text, type) {
            const el = document.createElement('div');
            el.className = `floating-text ${type}`;
            el.innerText = text;
            el.style.left = '50%';
            el.style.top = '40%';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function triggerMagicEffect() {
            effectLayer.className = 'effect-overlay';
            void effectLayer.offsetWidth;
            effectLayer.classList.add('magic-fire');
            setTimeout(() => effectLayer.className = 'effect-overlay', 500);
        }

        // --- SHOP ---
        function buyPotion() {
            if(gold >= 50 && playerHP < 5) {
                gold -= 50;
                playerHP++;
                showFloatingText("+1 HP", "text-gain");
                updateUI();
            }
        }

        function buyHint() {
            if(gold >= 30 && isHotMode) {
                gold -= 30;
                const buttons = Array.from(abcdOptions.querySelectorAll('button:not(.correct-select)'));
                let wrongButtons = buttons.filter(btn => !btn.dataset.isCorrect);
                for(let i=0; i<2 && i<wrongButtons.length; i++) {
                    wrongButtons[i].classList.add('hidden-hint');
                }
                btnBuyHint.disabled = true;
                updateUI();
            }
        }

        // --- CORE LOOP ---
        function loadCard() {
            if (playerHP <= 0) { gameOver(); return; }
            if (deck.length === 0) { victory(); return; }

            clearInterval(hotTimerInterval);
            hotContainer.style.display = 'none';
            cardContainer.style.display = 'block';
            controls.style.display = 'flex';
            controls.classList.remove('visible');
            flashcard.classList.remove('flipped');
            isFlipped = false;
            isHotMode = false;

            // Chance logic
            let hotChance = rageModeActive ? 0.5 : 0.1;
            if (deck.length === currentDeck.length) hotChance = 0; // First card safe

            if (Math.random() < hotChance) {
                startHotMode();
            } else {
                startNormalMode();
            }
            updateUI();
        }

        function startNormalMode() {
            const currentCard = deck[0];
            let cat = "KARTA";
            categoryFront.innerText = cat;
            questionText.innerText = currentCard.q;
            answerText.innerText = currentCard.a;
        }

        function startHotMode() {
            isHotMode = true;
            cardContainer.style.display = 'none';
            controls.style.display = 'none';
            hotContainer.style.display = 'flex';
            updateUI(); 

            const currentCard = deck[0];
            hotQuestionText.innerText = currentCard.q;
            const correctAnswer = currentCard.a;
            
            const otherAnswers = currentDeck
                .filter(item => item.a !== correctAnswer)
                .map(item => item.a)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            const allOptions = [...otherAnswers, correctAnswer].sort(() => 0.5 - Math.random());

            abcdOptions.innerHTML = '';
            allOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'abcd-btn';
                btn.innerText = opt;
                if(opt === correctAnswer) btn.dataset.isCorrect = "true";
                btn.onclick = () => checkHotAnswer(btn, opt === correctAnswer);
                abcdOptions.appendChild(btn);
            });

            let duration = rageModeActive ? 7 : 10;
            timerFill.style.width = '100%';
            timerFill.style.transition = 'none';
            void timerFill.offsetWidth;
            timerFill.style.transition = `width ${duration}s linear`;
            timerFill.style.width = '0%';

            hotTimerInterval = setTimeout(() => {
                if(isHotMode) handleHotResult(false);
            }, duration * 1000);
        }

        function checkHotAnswer(btn, isCorrect) {
            clearTimeout(hotTimerInterval);
            const buttons = abcdOptions.querySelectorAll('button');
            buttons.forEach(b => b.disabled = true);
            if(isCorrect) {
                btn.classList.add('correct-select');
                handleHotResult(true);
            } else {
                btn.classList.add('wrong-select');
                handleHotResult(false);
            }
        }

        function handleHotResult(success) {
            if(success) {
                combo++;
                let gain = 50 + (combo * 10);
                gold += gain;
                showFloatingText(`+${gain}g`, "text-hot-gain");
                triggerMagicEffect();
                deck.shift(); 
            } else {
                combo = 0;
                gold -= 30;
                playerHP--;
                showFloatingText("-1 HP", "text-loss");
                hotContainer.classList.add('shake');
                setTimeout(() => hotContainer.classList.remove('shake'), 500);
                const card = deck.shift();
                deck.push(card);
            }
            updateUI();
            setTimeout(loadCard, 1500);
        }

        function flipCard() {
            if(isHotMode) return;
            if (deck.length === 0) return;
            isFlipped = !isFlipped;
            flashcard.classList.toggle('flipped');
            if(isFlipped) controls.classList.add('visible');
            else controls.classList.remove('visible');
        }

        function removeCard(e) {
            e.stopPropagation();
            combo++;
            let multiplier = 1 + (combo * 0.1);
            let gain = Math.floor(20 * multiplier);
            gold += gain;
            showFloatingText(`+${gain}g`, "text-gain");
            cardContainer.classList.add('shake');
            setTimeout(() => cardContainer.classList.remove('shake'), 500);
            triggerMagicEffect();
            deck.shift();
            loadCard();
        }

        function keepCard(e) {
            e.stopPropagation();
            combo = 0;
            gold -= 10;
            playerHP--;
            showFloatingText("-1 HP", "text-loss");
            const current = deck.shift();
            deck.push(current);
            loadCard();
        }

        function victory() { showEndScreen("VICTORY!", "Dungeon Cleared!", "#f1c40f"); }
        function gameOver() { showEndScreen("GAME OVER", "You died.", "#e74c3c"); }

        function showEndScreen(title, msg, color) {
            gameSection.style.display = 'none';
            bossUi.style.display = 'none';
            controls.style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            document.getElementById('end-title').innerText = title;
            document.getElementById('end-title').style.color = color;
            document.getElementById('end-msg').innerText = msg;
            document.getElementById('final-gold').innerText = `${gold} Gold`;
            
            let rank = "Noob";
            if (gold < 0) rank = "Corpse";
            else if (gold < 1000) rank = "Apprentice";
            else if (gold < 2500) rank = "Adventurer";
            else rank = "Hero";
            document.getElementById('final-rank').innerText = rank;
        }

    </script>
</body>
</html>